<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Clube Prato & Peso – Montar prato brasileiro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f5f5f7;
      --bg-alt: #ffffff;
      --primary: #1e5a4d;
      --primary-soft: #e0f3ec;
      --accent: #ffb347;
      --accent-soft: #fff3df;
      --text-main: #222222;
      --text-muted: #666666;
      --border-soft: #e0e0e0;
      --radius-lg: 16px;
      --radius-xl: 22px;
      --shadow-soft: 0 12px 30px rgba(0, 0, 0, 0.08);
      --max-width: 1040px;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #fdf5ea 0, #f5f5f7 45%, #f0f2f5 100%);
      color: var(--text-main);
      min-height: 100vh;
      display:flex;
      flex-direction:column;
    }

    header {
      background: rgba(255,255,255,0.96);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-inner {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 10px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .logo {
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color:inherit;
    }
    .logo-badge {
      width:30px; height:30px;
      border-radius:50%;
      background:var(--accent);
      display:flex; align-items:center; justify-content:center;
      font-weight:700; color:#4b2c15; font-size:0.9rem;
      box-shadow:0 6px 14px rgba(0,0,0,0.1);
    }
    .logo-text { display:flex; flex-direction:column; gap:2px; }
    .logo-text-main { font-weight:700; font-size:0.98rem; letter-spacing:0.03em; }
    .logo-text-sub { font-size:0.75rem; color:var(--text-muted); }

    .header-pill {
      padding:6px 12px;
      border-radius:999px;
      border:1px solid var(--border-soft);
      background:#f5f5f7;
      font-size:0.8rem;
      cursor:pointer;
    }

    main {
      flex:1;
      padding:24px 16px 40px;
    }
    .main-inner {
      max-width:var(--max-width);
      margin:0 auto;
    }

    .card {
      background:var(--bg-alt);
      border-radius:var(--radius-xl);
      box-shadow:var(--shadow-soft);
      border:1px solid var(--border-soft);
      padding:18px 16px;
      margin-bottom:18px;
    }

    h1 {
      font-size:1.3rem;
      margin-bottom:4px;
    }

    h2 {
      font-size:1.05rem;
      margin-top:10px;
      margin-bottom:4px;
    }

    .card small {
      color:var(--text-muted);
      font-size:0.85rem;
    }

    label {
      display:block;
      font-size:0.85rem;
      margin-bottom:4px;
    }

    input[type="number"],
    input[type="date"],
    select {
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #d1d5db;
      font-size:0.9rem;
      background:#f9fafb;
    }

    input:focus,
    select:focus {
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 1px var(--primary-soft);
      background:#fff;
    }

    .row { display:flex; flex-wrap:wrap; gap:12px; margin-top:6px; }
    .col { flex:1; min-width:140px; }

    button.primary {
      margin-top:14px;
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:999px;
      padding:9px 18px;
      font-size:0.9rem;
      cursor:pointer;
      box-shadow:0 10px 22px rgba(0,0,0,0.18);
    }

    button.primary:disabled {
      opacity:0.6;
      cursor:default;
      box-shadow:none;
    }

    .btn-secondary {
      background:#f3f4f6;
      color:#111827;
      border-radius:999px;
      border:1px solid #d1d5db;
      padding:8px 14px;
      font-size:0.86rem;
      cursor:pointer;
    }
    .btn-secondary:hover {
      background:#e5e7eb;
    }

    .message {
      margin-top:8px;
      font-size:0.85rem;
      display:none;
    }
    .message.ok { color:#15803d; }
    .message.error { color:#b91c1c; }

    .resumo-box {
      margin-top:14px;
      padding:10px 12px;
      border-radius:var(--radius-lg);
      border:1px solid #e5e7eb;
      background:#f9fafb;
      font-size:0.88rem;
    }
    .resumo-box strong { font-size:1.05rem; }

    /* --- Área do Montador de Prato --- */
    .section-lead {
      font-size:0.9rem;
      color:var(--text-muted);
      margin-bottom:8px;
    }

    .form-grid {
      margin-top:8px;
      display:grid;
      grid-template-columns:minmax(0,1fr);
      gap:10px 12px;
    }

    .form-row {
      display:grid;
      grid-template-columns:minmax(0,1.4fr) minmax(0,0.8fr);
      gap:10px;
    }

    .form-group {
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:0.86rem;
    }

    .hint {
      font-size:0.74rem;
      color:var(--text-muted);
    }

    .actions-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:12px;
    }

    .error-msg {
      font-size:0.8rem;
      color:#b91c1c;
      margin-top:8px;
      display:none;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      font-size:0.85rem;
    }

    th,
    td {
      border-bottom:1px solid #e5e7eb;
      padding:6px 4px;
      text-align:left;
    }

    th {
      font-weight:600;
      color:#374151;
    }

    .text-right { text-align:right; }

    .data-row {
      font-size:0.85rem;
    }

    .resultado-total {
      font-size:0.95rem;
      font-weight:500;
      margin-top:10px;
    }

    .resultado-meta {
      font-size:0.83rem;
      color:var(--text-muted);
      margin-top:2px;
    }

    .summary-note {
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      background:#f9fafb;
      font-size:0.8rem;
      color:var(--text-muted);
    }

    footer {
      background:#111;
      color:#d0d0d0;
      font-size:0.78rem;
      padding:12px 16px 16px;
      margin-top:12px;
    }
    .footer-inner {
      max-width:var(--max-width);
      margin:0 auto;
      text-align:center;
    }

    @media (max-width:880px) {
      .form-row {
        grid-template-columns:minmax(0,1fr);
      }
    }

    @media (max-width:640px) {
      main { padding-inline:12px; }
      .header-inner { padding-inline:10px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <a href="clube-area.html" class="logo">
        <div class="logo-badge">P&amp;P</div>
        <div class="logo-text">
          <div class="logo-text-main">Prato &amp; Peso</div>
          <div class="logo-text-sub">Clube – Prato brasileiro</div>
        </div>
      </a>

      <button class="header-pill" onclick="window.location.href='clube-area.html'">
        ← Voltar para o Clube
      </button>
    </div>
  </header>

  <main>
    <div class="main-inner">
      <section class="card">
        <h1>Montar prato brasileiro – Clube</h1>
        <small>
          Aqui você monta o prato com comida de verdade, vê as calorias aproximadas
          e depois salva o <strong>resumo do dia</strong> na sua conta do Clube para usar no
          <strong>Resumo rápido</strong> e no <strong>Relatório</strong>.
        </small>

        <!-- 1. MONTAR O PRATO -->
        <h2>1. Monte seu prato</h2>
        <p class="section-lead">
          Escolha alimentos típicos de prato brasileiro, ajuste as quantidades em porções simples
          (colher, concha, unidade) e veja quantas calorias seu prato tem.
        </p>

        <form class="form-grid" onsubmit="return false;">
          <div class="form-row">
            <div class="form-group">
              <label for="alimento-select">Alimento</label>
              <select id="alimento-select">
                <option value="">Selecione...</option>
                <option value="arroz">Arroz branco cozido</option>
                <option value="feijao">Feijão carioca cozido</option>
                <option value="bife">Bife bovino grelhado</option>
                <option value="frango">Frango grelhado</option>
                <option value="ovo-frito">Ovo frito</option>
                <option value="ovo-cozido">Ovo cozido</option>
                <option value="salada">Salada verde</option>
                <option value="farofa">Farofa</option>
                <option value="batata-cozida">Batata cozida</option>
                <option value="batata-frita">Batata frita</option>
                <option value="macarrao">Macarrão alho e óleo</option>
                <option value="feijoada">Feijoada</option>
                <option value="linguica">Linguiça assada</option>
                <option value="couve">Couve refogada</option>
                <option value="arroz-integral">Arroz integral cozido</option>
                <option value="banana">Banana prata</option>
                <option value="pao-frances">Pão francês</option>
                <option value="cafe-com-acucar">Café com açúcar</option>
              </select>
              <div class="hint" id="alimento-info">
                Escolha um alimento para ver a porção padrão e as calorias aproximadas.
              </div>
            </div>

            <div class="form-group">
              <label for="quantidade">Quantidade (em porções)</label>
              <input type="number" id="quantidade" min="0" step="0.5" placeholder="Ex.: 1, 1,5, 2" />
              <div class="hint">
                Ex.: 1 = porção padrão, 2 = o dobro, 0,5 = metade.
              </div>
            </div>
          </div>

          <div class="actions-row">
            <button id="btn-adicionar" class="btn-secondary" type="button">Adicionar ao prato</button>
            <button id="btn-limpar-prato" class="btn-secondary" type="button">Limpar prato</button>
          </div>

          <div class="error-msg" id="erro-mensagem"></div>
        </form>

        <div style="overflow-x:auto; margin-top:8px;">
          <table>
            <thead>
              <tr>
                <th>Alimento</th>
                <th class="text-right">Porções</th>
                <th class="text-right">kcal (aprox.)</th>
              </tr>
            </thead>
            <tbody id="tabela-itens">
              <tr>
                <td colspan="3">
                  Nenhum alimento no prato ainda. Comece adicionando arroz, feijão, bife, ovo...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="resultado-total">
          <div><strong>Total do prato:</strong> <span id="total-kcal">0 kcal</span></div>
          <div class="resultado-meta" id="texto-meta">
            Informe uma meta diária para ver o percentual.
          </div>
        </div>

        <div class="row" style="margin-top:8px;">
          <div class="col">
            <label for="meta-diaria">Meta diária de calorias (opcional)</label>
            <input type="number" id="meta-diaria" min="800" max="6000" />
            <div class="hint">
              Ex.: 1.900 kcal/dia (pode vir do TDEE).
            </div>
          </div>
        </div>

        <div class="summary-note">
          Use esse prato como referência, compare com sua meta diária e veja se precisa ajustar nas quantidades
          ou nos tipos de alimentos.
        </div>

        <!-- 2. REGISTRAR O DIA NO CLUBE -->
        <h2 style="margin-top:18px;">2. Registrar o dia no Clube</h2>

        <div class="row" style="margin-top:8px;">
          <div class="col">
            <label for="data">Data</label>
            <input type="date" id="data" />
          </div>
          <div class="col">
            <label for="calorias">Calorias totais do dia (kcal)</label>
            <input type="number" id="calorias" min="0" step="1" />
          </div>
        </div>

        <button class="primary" id="btnSalvar">
          Salvar dia no Clube
        </button>
        <div id="msg" class="message"></div>

        <div id="resumoDia" class="resumo-box" style="display:none;">
          <p>
            <strong id="resumoCalorias">–</strong>
          </p>
        </div>

        <small style="display:block; margin-top:12px; color:var(--text-muted); font-size:0.8rem;">
          Dica: você pode montar diferentes pratos ao longo do dia, somar as calorias e registrar aqui o total
          para ficar salvo no seu histórico do Clube.
        </small>
      </section>
    </div>
  </main>

  <footer>
    <div class="footer-inner">
      © <span id="anoAtual"></span> Prato &amp; Peso – Clube. Registros de pratos salvos na sua conta.
    </div>
  </footer>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyABfAWUAW6a6g93B9QKooTKd5Mj645G3vE",
      authDomain: "prato-e-peso-77b5a.firebaseapp.com",
      projectId: "prato-e-peso-77b5a",
      storageBucket: "prato-e-peso-77b5a.firebasestorage.app",
      messagingSenderId: "432109202072",
      appId: "1:432109202072:web:1c8636db0c161318ddfeed"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Ano rodapé
    const anoAtualSpan = document.getElementById("anoAtual");
    anoAtualSpan.textContent = new Date().getFullYear();

    // ---------- CAMPOS DO REGISTRO NO CLUBE ----------
    const dataInput = document.getElementById("data");
    const caloriasInput = document.getElementById("calorias");
    const btnSalvar = document.getElementById("btnSalvar");
    const msg = document.getElementById("msg");
    const resumoDia = document.getElementById("resumoDia");
    const resumoCalorias = document.getElementById("resumoCalorias");

    let currentUid = null;

    function setHoje() {
      const hoje = new Date();
      const yyyy = hoje.getFullYear();
      const mm = String(hoje.getMonth() + 1).padStart(2, "0");
      const dd = String(hoje.getDate()).padStart(2, "0");
      dataInput.value = `${yyyy}-${mm}-${dd}`;
    }

    function mostrarMsg(texto, tipo) {
      msg.style.display = texto ? "block" : "none";
      msg.textContent = texto || "";
      msg.classList.remove("ok","error");
      if (tipo === "ok") msg.classList.add("ok");
      if (tipo === "error") msg.classList.add("error");
    }

    function formatarDataBR(dataISO) {
      if (!dataISO) return "";
      const [ano, mes, dia] = dataISO.split("-");
      return `${dia}/${mes}/${ano}`;
    }

    async function salvarDia() {
      mostrarMsg("");

      if (!currentUid) {
        mostrarMsg("Não foi possível identificar sua conta. Faça login novamente.", "error");
        return;
      }

      const data = dataInput.value;
      const calorias = parseFloat(caloriasInput.value);

      if (!data || isNaN(calorias)) {
        mostrarMsg("Preencha a data e as calorias totais do dia.", "error");
        return;
      }

      btnSalvar.disabled = true;
      mostrarMsg("Salvando no Clube...", "ok");

      try {
        const docId = `${currentUid}_${data}`;
        await db.collection("consumosDiarios").doc(docId).set({
          uid: currentUid,
          data,
          caloriasTotais: calorias,
          atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
        });

        const calFmt = Math.round(calorias).toLocaleString("pt-BR");
        resumoCalorias.textContent = `${calFmt} kcal no dia ${formatarDataBR(data)}`;

        resumoDia.style.display = "block";
        mostrarMsg("Dia salvo com sucesso no Clube! ✅", "ok");
      } catch (err) {
        console.error("Erro ao salvar consumo diário:", err);
        mostrarMsg("Erro ao salvar no Clube. Tente novamente.", "error");
      } finally {
        btnSalvar.disabled = false;
      }
    }

    btnSalvar.addEventListener("click", salvarDia);

    auth.onAuthStateChanged((user) => {
      if (!user) {
        window.location.href = "clube-login.html";
        return;
      }
      currentUid = user.uid;
      setHoje();
    });

    // ---------- FUNCIONALIDADES DO MONTADOR DE PRATO ----------
    const ALIMENTOS = {
      "arroz": {
        nome: "Arroz branco cozido",
        porcao: "1 colher de servir (~50 g)",
        kcalPorPorcao: 65
      },
      "feijao": {
        nome: "Feijão carioca cozido",
        porcao: "1 concha pequena (~80 g)",
        kcalPorPorcao: 70
      },
      "bife": {
        nome: "Bife bovino grelhado",
        porcao: "1 pedaço médio (~80 g)",
        kcalPorPorcao: 200
      },
      "frango": {
        nome: "Peito de frango grelhado",
        porcao: "1 filé médio (~100 g)",
        kcalPorPorcao: 165
      },
      "ovo-frito": {
        nome: "Ovo de galinha frito",
        porcao: "1 unidade média",
        kcalPorPorcao: 110
      },
      "ovo-cozido": {
        nome: "Ovo de galinha cozido",
        porcao: "1 unidade média",
        kcalPorPorcao: 80
      },
      "salada": {
        nome: "Salada verde (alface, tomate, cenoura)",
        porcao: "1 prato de sobremesa",
        kcalPorPorcao: 25
      },
      "farofa": {
        nome: "Farofa simples",
        porcao: "1 colher de sopa cheia (~20 g)",
        kcalPorPorcao: 70
      },
      "batata-cozida": {
        nome: "Batata inglesa cozida",
        porcao: "1 unidade média (~80 g)",
        kcalPorPorcao: 60
      },
      "macarrao": {
        nome: "Macarrão alho e óleo",
        porcao: "1 concha média (~80 g)",
        kcalPorPorcao: 140
      },
      "batata-frita": {
        nome: "Batata frita",
        porcao: "1 porção pequena (~80 g)",
        kcalPorPorcao: 160
      },
      "feijoada": {
        nome: "Feijoada",
        porcao: "1 concha média (~120 g)",
        kcalPorPorcao: 220
      },
      "linguica": {
        nome: "Linguiça assada",
        porcao: "1 unidade média (~60 g)",
        kcalPorPorcao: 180
      },
      "couve": {
        nome: "Couve refogada",
        porcao: "1 colher de servir (~40 g)",
        kcalPorPorcao: 45
      },
      "arroz-integral": {
        nome: "Arroz integral cozido",
        porcao: "1 colher de servir (~50 g)",
        kcalPorPorcao: 60
      },
      "banana": {
        nome: "Banana prata",
        porcao: "1 unidade média",
        kcalPorPorcao: 90
      },
      "pao-frances": {
        nome: "Pão francês",
        porcao: "1 unidade média (~50 g)",
        kcalPorPorcao: 135
      },
      "cafe-com-acucar": {
        nome: "Café com açúcar",
        porcao: "1 xícara pequena (50 ml)",
        kcalPorPorcao: 25
      }
    };

    let itensPrato = [];

    const selectAlimento = document.getElementById("alimento-select");
    const campoQuantidade = document.getElementById("quantidade");
    const infoAlimento = document.getElementById("alimento-info");
    const erroMensagem = document.getElementById("erro-mensagem");

    const tabelaItens = document.getElementById("tabela-itens");
    const totalKcalSpan = document.getElementById("total-kcal");
    const metaDiariaInput = document.getElementById("meta-diaria");
    const textoMeta = document.getElementById("texto-meta");

    const btnAdicionar = document.getElementById("btn-adicionar");
    const btnLimparPrato = document.getElementById("btn-limpar-prato");

    function formatNumber(num, casas = 1) {
      return num.toLocaleString("pt-BR", { minimumFractionDigits: casas, maximumFractionDigits: casas });
    }

    function atualizarInfoAlimento() {
      const id = selectAlimento.value;
      const alimento = ALIMENTOS[id];

      if (!alimento) {
        infoAlimento.textContent = "Escolha um alimento para ver a porção padrão e as calorias aproximadas.";
        return;
      }

      infoAlimento.textContent = `${alimento.nome} – ${alimento.porcao} ≈ ${alimento.kcalPorPorcao} kcal`;
    }

    function atualizarTabela() {
      tabelaItens.innerHTML = "";
      let totalKcal = 0;

      if (!itensPrato.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 3;
        td.textContent = "Nenhum alimento no prato ainda. Comece adicionando arroz, feijão, bife, ovo...";
        tr.appendChild(td);
        tabelaItens.appendChild(tr);
      } else {
        itensPrato.forEach((item) => {
          totalKcal += item.kcal;

          const tr = document.createElement("tr");
          tr.className = "data-row";

          const tdNome = document.createElement("td");
          tdNome.textContent = item.nome;

          const tdQtd = document.createElement("td");
          tdQtd.className = "text-right";
          tdQtd.textContent = formatNumber(item.quantidade, 1);

          const tdKcal = document.createElement("td");
          tdKcal.className = "text-right";
          tdKcal.textContent = formatNumber(item.kcal, 0);

          tr.appendChild(tdNome);
          tr.appendChild(tdQtd);
          tr.appendChild(tdKcal);

          tabelaItens.appendChild(tr);
        });
      }

      totalKcalSpan.textContent = `${formatNumber(totalKcal, 0)} kcal`;

      // joga esse total no campo de calorias do dia
      caloriasInput.value = Math.round(totalKcal);

      atualizarPercentualMeta();
    }

    function atualizarPercentualMeta() {
      const meta = Number(String(metaDiariaInput.value || "0").replace(",", "."));
      const totalTexto = totalKcalSpan.textContent || "0";
      const numeroTotal = Number(totalTexto.replace(/[^\d,.-]/g, "").replace(".", "").replace(",", "."));

      if (!meta || meta <= 0) {
        textoMeta.textContent = "Informe uma meta diária para ver o percentual.";
        return;
      }

      if (!numeroTotal || numeroTotal <= 0) {
        textoMeta.textContent = "Adicione alimentos ao prato para ver o percentual da meta.";
        return;
      }

      const percentual = (numeroTotal / meta) * 100;
      const percStr = percentual.toLocaleString("pt-BR", { minimumFractionDigits: 1, maximumFractionDigits: 1 });

      let classificacao = "";
      if (percentual < 25) classificacao = "baixo para uma refeição principal";
      else if (percentual < 50) classificacao = "uma refeição moderada";
      else if (percentual < 75) classificacao = "uma refeição mais pesada";
      else classificacao = "muito pesado para uma única refeição";

      textoMeta.textContent = `Este prato representa cerca de ${percStr}% da sua meta diária – ${classificacao}.`;
    }

    selectAlimento.addEventListener("change", atualizarInfoAlimento);

    metaDiariaInput.addEventListener("input", function () {
      atualizarPercentualMeta();
    });

    btnAdicionar.addEventListener("click", function () {
      erroMensagem.style.display = "none";

      const id = selectAlimento.value;
      const alimento = ALIMENTOS[id];

      if (!alimento) {
        erroMensagem.textContent = "Selecione um alimento antes de adicionar.";
        erroMensagem.style.display = "block";
        return;
      }

      const qtdVal = Number(String(campoQuantidade.value).replace(",", "."));

      if (!qtdVal || qtdVal <= 0) {
        erroMensagem.textContent = "Informe a quantidade de porções (ex.: 1, 1,5, 2).";
        erroMensagem.style.display = "block";
        return;
      }

      const kcalItem = alimento.kcalPorPorcao * qtdVal;

      itensPrato.push({
        id,
        nome: alimento.nome,
        quantidade: qtdVal,
        kcal: kcalItem,
      });

      campoQuantidade.value = "";
      atualizarTabela();
    });

    btnLimparPrato.addEventListener("click", function () {
      itensPrato = [];
      atualizarTabela();
      erroMensagem.style.display = "none";
    });

    // Inicial
    atualizarTabela();
    atualizarInfoAlimento();
  </script>
</body>
</html>
