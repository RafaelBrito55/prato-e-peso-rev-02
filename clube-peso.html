<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Clube Prato & Peso ‚Äì Meu peso</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f5f5f7;
      --bg-alt: #ffffff;
      --primary: #1e5a4d;
      --primary-soft: #e0f3ec;
      --accent: #ffb347;
      --accent-soft: #fff3df;
      --text-main: #222222;
      --text-muted: #555555;
      --border-soft: #e0e0e0;
      --radius: 16px;
      --shadow-soft: 0 10px 26px rgba(15, 23, 42, 0.12);
      --max-width: 960px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #fdf7f0 0, #f5f5f7 45%, #eceff1 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    header {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(224, 224, 224, 0.8);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .header-inner {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width:30px; height:30px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 20%, #ffd28a, #ffb347);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
    }

    .logo-badge span {
      font-weight:700;
      color:#3f2410;
      font-size:0.8rem;
    }

    .logo-text {
      display:flex;
      flex-direction:column;
      gap:2px;
    }

    .logo-text strong {
      font-size:0.95rem;
      letter-spacing:0.02em;
    }

    .logo-text small {
      font-size:0.75rem;
      color:var(--text-muted);
    }

    .btn-link {
      border-radius:999px;
      padding:7px 14px;
      border:none;
      background:var(--primary-soft);
      color:var(--primary);
      font-size:0.8rem;
      font-weight:500;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      box-shadow:0 4px 10px rgba(15,23,42,0.12);
      transition:background 0.2s, transform 0.1s, box-shadow 0.2s;
      text-decoration:none;
    }

    .btn-link:hover {
      background:#d2eee3;
      transform:translateY(-1px);
      box-shadow:0 8px 18px rgba(15,23,42,0.18);
    }

    .btn-link span {
      font-size:1rem;
    }

    main {
      flex:1;
      display:flex;
      justify-content:center;
      padding:24px 16px 32px;
    }

    .page-container {
      width:100%;
      max-width:var(--max-width);
    }

    .card-main {
      background:var(--bg-alt);
      border-radius:24px;
      box-shadow:var(--shadow-soft);
      padding:28px 24px 24px;
      position:relative;
      overflow:hidden;
    }

    .card-main::before {
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at top right,
        rgba(255,179,71,0.13),
        transparent 55%);
      pointer-events:none;
    }

    .card-main-inner {
      position:relative;
      z-index:1;
    }

    .page-header {
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom:18px;
    }

    .page-badge {
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:0.78rem;
      color:var(--text-muted);
      padding:4px 10px;
      border-radius:999px;
      background:rgba(30,90,77,0.06);
      border:1px solid rgba(30,90,77,0.14);
      width:fit-content;
    }

    .page-badge span {
      font-size:0.9rem;
    }

    h1 {
      font-size:1.5rem;
      margin-bottom:4px;
    }

    .lead {
      font-size:0.9rem;
      color:var(--text-muted);
      margin-bottom:16px;
    }

    .card {
      background:rgba(255,255,255,0.9);
      border-radius:18px;
      border:1px solid rgba(224,224,224,0.7);
      padding:18px 18px 14px;
      box-shadow:0 6px 16px rgba(15,23,42,0.10);
      margin-bottom:18px;
    }

    .card-header {
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom:10px;
      gap:10px;
    }

    .card-title {
      font-size:1rem;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .card-title span {
      font-size:1.1rem;
    }

    .card-subtitle {
      font-size:0.8rem;
      color:var(--text-muted);
    }

    .form-row {
      display:flex;
      gap:12px;
      margin-bottom:12px;
    }

    .form-group {
      flex:1;
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    label {
      font-size:0.8rem;
      color:var(--text-muted);
      font-weight:500;
    }

    input[type="date"],
    input[type="number"] {
      padding:8px 11px;
      border-radius:999px;
      border:1px solid var(--border-soft);
      font-size:0.85rem;
      outline:none;
      background:rgba(249,250,251,0.95);
      transition:border-color 0.18s, box-shadow 0.18s, background 0.18s;
    }

    input[type="date"]:focus,
    input[type="number"]:focus {
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(30,90,77,0.15);
      background:#ffffff;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance:none;
      margin:0;
    }

    .btn-primary {
      padding:9px 20px;
      border-radius:999px;
      border:none;
      background:var(--primary);
      color:#ffffff;
      font-size:0.9rem;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      box-shadow:0 10px 22px rgba(15,23,42,0.25);
      transition:background 0.18s, transform 0.1s, box-shadow 0.18s;
      min-width:130px;
    }

    .btn-primary:hover {
      background:#194b40;
      transform:translateY(-1px);
      box-shadow:0 14px 26px rgba(15,23,42,0.3);
    }

    .btn-primary:disabled {
      opacity:0.6;
      cursor:not-allowed;
      box-shadow:none;
      transform:none;
    }

    .info-text {
      font-size:0.8rem;
      color:var(--text-muted);
      margin-top:4px;
    }

    .message {
      margin-top:10px;
      font-size:0.82rem;
      padding:8px 11px;
      border-radius:999px;
      display:none;
      align-items:center;
      gap:8px;
    }

    .message.ok {
      display:flex;
      background:rgba(46, 125, 50, 0.08);
      color:#1b5e20;
      border:1px solid rgba(129, 199, 132, 0.8);
    }

    .message.error {
      display:flex;
      background:rgba(211, 47, 47, 0.08);
      color:#b71c1c;
      border:1px solid rgba(239, 154, 154, 0.9);
    }

    .message span {
      font-size:1rem;
    }

    .table-card {
      margin-top:6px;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:4px;
    }

    th,
    td {
      text-align:left;
      padding:8px 0;
      font-size:0.85rem;
      border-bottom:1px solid rgba(224,224,224,0.8);
    }

    th {
      font-size:0.78rem;
      text-transform:uppercase;
      letter-spacing:0.02em;
      color:var(--text-muted);
    }

    tbody tr:last-child td {
      border-bottom:none;
    }

    @media (max-width:540px) {
      .form-row { flex-direction:column; }
    }
    /* Bot√£o de excluir peso */
    .btn-delete {
      border-radius:999px;
      padding:4px 10px;
      border:1px solid #e57373;
      background:#fff5f5;
      color:#c62828;
      font-size:0.75rem;
      cursor:pointer;
      transition:background 0.2s, transform 0.1s, box-shadow 0.2s;
      white-space:nowrap;
    }

    .btn-delete:hover {
      background:#ffebee;
      transform:translateY(-1px);
      box-shadow:0 4px 10px rgba(0, 0, 0, 0.08);
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <a href="club-area.html" class="logo-area">
        <div class="logo-badge">
          <span>PaP</span>
        </div>
        <div class="logo-text">
          <strong>Prato & Peso</strong>
          <small>Clube ‚Äì Meu peso</small>
        </div>
      </a>

      <a href="club-area.html" class="btn-link">
        <span>‚Üê</span>
        Voltar para o painel
      </a>
    </div>
  </header>

  <main>
    <div class="page-container">
      <section class="card-main">
        <div class="card-main-inner">
          <div class="page-header">
            <div class="page-badge">
              <span>‚öñÔ∏è</span>
              Meu peso ao longo do tempo
            </div>
            <h1>Meu peso</h1>
            <p class="lead">
              Registre seu peso e acompanhe a evolu√ß√£o ao longo do tempo. Esses dados ser√£o usados no painel e no relat√≥rio.
            </p>
          </div>

          <section class="card">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <span>üìù</span>
                  <span>Registrar peso</span>
                </div>
                <p class="card-subtitle">
                  Salve sempre que tiver uma nova pesagem.
                </p>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="pesoData">Data</label>
                <input type="date" id="pesoData" />
              </div>
              <div class="form-group">
                <label for="pesoValor">Peso (kg)</label>
                <input type="number" id="pesoValor" step="0.1" placeholder="Ex: 82,5" />
              </div>
            </div>

            <button class="btn-primary" id="btnSalvarPeso">
              <span>üíæ</span>
              Salvar peso
            </button>

            <p class="info-text">
              Dica: tente se pesar em hor√°rios parecidos (por exemplo, de manh√£ ao acordar) para ter uma leitura mais fiel da evolu√ß√£o.
            </p>

            <div id="pesoMessage" class="message">
              <span>‚ÑπÔ∏è</span>
              <span></span>
            </div>
          </section>

          <section class="card table-card">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <span>üìä</span>
                  <span>Hist√≥rico de pesos</span>
                </div>
                <p class="card-subtitle">
                  Os registros mais recentes aparecem no topo. At√© 60 pesagens s√£o exibidas aqui.
                </p>
              </div>
            </div>

            <table>
              <thead>
          <tr>
            <th>Data</th>
            <th>Peso (kg)</th>
            <th style="text-align:right;">A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="listaPesos"></tbody>
      </table>
    </section>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyABfAWUAW6a6g93B9QKooTKd5Mj645G3vE",
      authDomain: "prato-e-peso-77b5a.firebaseapp.com",
      projectId: "prato-e-peso-77b5a",
      storageBucket: "prato-e-peso-77b5a.firebasestorage.app",
      messagingSenderId: "432109202072",
      appId: "1:432109202072:web:1c8636db0c161318ddfeed"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const pesoDataInput = document.getElementById("pesoData");
    const pesoValorInput = document.getElementById("pesoValor");
    const btnSalvarPeso = document.getElementById("btnSalvarPeso");
    const pesoMessage = document.getElementById("pesoMessage");
    const listaPesos = document.getElementById("listaPesos");

    let currentUid = null;

    function mostrarMensagem(el, texto, tipo) {
      if (!el) return;
      if (!texto) {
        el.style.display = "none";
        el.classList.remove("ok", "error");
        el.querySelectorAll("span")[1].textContent = "";
        return;
      }

      el.style.display = "flex";
      el.classList.remove("ok", "error");
      el.classList.add(tipo || "ok");
      el.querySelectorAll("span")[1].textContent = texto;
    }

    function formatarDataBR(dataISO) {
      if (!dataISO) return "";
      const [yyyy, mm, dd] = dataISO.split("-");
      return `${dd}/${mm}/${yyyy}`;
    }

    async function carregarPesos(uid) {
      listaPesos.innerHTML = "";
      mostrarMensagem(pesoMessage, "", "");

      try {
        const snapshot = await db
          .collection("pesos")
          .where("uid", "==", uid)
          .get();

        if (snapshot.empty) {
          return;
        }

        const docs = snapshot.docs.slice();
        docs.sort((a, b) => {
          const da = (a.data().data || "");
          const dbb = (b.data().data || "");
          if (da < dbb) return 1;
          if (da > dbb) return -1;
          return 0;
        });

        const limitados = docs.slice(0, 60);
        limitados.forEach(doc => {
          const dados = doc.data();
          adicionarLinhaPeso(dados.data, dados.peso, doc.id);
        });
      } catch (err) {
        console.error("Erro ao carregar pesos:", err);
        mostrarMensagem(pesoMessage, "N√£o foi poss√≠vel carregar seus pesos agora.", "error");
      }
    }

    function adicionarLinhaPeso(dataISO, peso, docId) {
      const tr = document.createElement("tr");
      const tdData = document.createElement("td");
      const tdPeso = document.createElement("td");
      const tdAcoes = document.createElement("td");

      tdData.textContent = formatarDataBR(dataISO);
      tdPeso.textContent = Number(peso).toLocaleString("pt-BR", {
        minimumFractionDigits: 1,
        maximumFractionDigits: 1
      });

      const btnExcluir = document.createElement("button");
      btnExcluir.textContent = "Excluir";
      btnExcluir.className = "btn-delete";
      btnExcluir.addEventListener("click", () => {
        excluirPeso(docId, dataISO);
      });

      tdAcoes.style.textAlign = "right";
      tdAcoes.appendChild(btnExcluir);

      tr.appendChild(tdData);
      tr.appendChild(tdPeso);
      tr.appendChild(tdAcoes);
      listaPesos.appendChild(tr);
    }

    async function excluirPeso(docId, dataISO) {
      const confirmar = confirm("Tem certeza que deseja excluir este registro de peso?");
      if (!confirmar) return;

      try {
        await db.collection("pesos").doc(docId).delete();
        mostrarMensagem(pesoMessage, "Peso exclu√≠do com sucesso!", "ok");
        if (currentUid) {
          await carregarPesos(currentUid);
        }
      } catch (err) {
        console.error("Erro ao excluir peso:", err);
        mostrarMensagem(pesoMessage, "N√£o foi poss√≠vel excluir o peso. Tente novamente.", "error");
      }
    }

    async function salvarPeso() {
      mostrarMensagem(pesoMessage, "", "");

      const data = pesoDataInput.value;
      const peso = parseFloat(pesoValorInput.value);

      if (!data || isNaN(peso)) {
        mostrarMensagem(pesoMessage, "Preencha a data e o peso.", "error");
        return;
      }

      btnSalvarPeso.disabled = true;
      mostrarMensagem(pesoMessage, "Salvando...", "ok");

      try {
        const docId = `${currentUid}_${data}`;
        await db.collection("pesos").doc(docId).set({
          uid: currentUid,
          data,
          peso
        });

        mostrarMensagem(pesoMessage, "Peso salvo com sucesso!", "ok");
        await carregarPesos(currentUid);
      } catch (err) {
        console.error("Erro ao salvar peso:", err);
        mostrarMensagem(pesoMessage, "Erro ao salvar peso. Tente novamente.", "error");
      } finally {
        btnSalvarPeso.disabled = false;
      }
    }

    btnSalvarPeso.addEventListener("click", salvarPeso);

    auth.onAuthStateChanged((user) => {
      if (!user) {
        window.location.href = "clube-login.html";
        return;
      }
      currentUid = user.uid;
      carregarPesos(currentUid);
    });
  </script>
</body>
</html>
