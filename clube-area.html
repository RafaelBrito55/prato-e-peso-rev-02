<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Clube Prato & Peso – Minha área</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f5f5f7;
      --bg-alt: #ffffff;
      --primary: #1e5a4d;
      --primary-soft: #e0f3ec;
      --accent: #ffb347;
      --text-main: #222222;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
      --radius-xl: 22px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.12);
      --max-width: 1120px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #fff7e6 0, #f5f5f7 45%, #e5e7eb 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* HEADER NOVO – mesmo estilo do Clube/Perfil */
    header {
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .header-inner {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: inherit;
    }

    .logo-badge {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #4b2c15;
      font-size: 0.95rem;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
    }

    .logo-text-main {
      font-weight: 800;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      font-size: 0.9rem;
      color: #111827;
    }

    .logo-text-sub {
      font-size: 0.78rem;
      color: #6b7280;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .header-link {
      font-size: 0.85rem;
      border-radius: 999px;
      padding: 8px 14px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #ffffff;
      color: #0f172a;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.18s ease-in-out;
    }

    .header-link:hover {
      border-color: #0f766e;
      color: #0f766e;
      box-shadow: 0 6px 16px rgba(15, 118, 110, 0.18);
      transform: translateY(-1px);
    }

    .header-link-cta {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #ffffff;
      border: none;
      font-weight: 600;
    }

    .header-link-cta:hover {
      background: linear-gradient(135deg, #22c55e, #15803d);
      color: #ecfdf5;
      transform: translateY(-1px) scale(1.01);
      box-shadow: 0 12px 30px rgba(22, 163, 74, 0.35);
    }

    @media (max-width: 640px) {
      .header-inner {
        padding-inline: 12px;
      }
    }

    main {
      padding: 24px 16px 36px;
    }

    .main-inner {
      max-width: var(--max-width);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .hero {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .hero h1 {
      font-size: 1.6rem;
      font-weight: 800;
    }

    .hero-subtitle {
      font-size: 0.92rem;
      color: var(--text-muted);
    }

    .cards-grid {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 720px) {
      .cards-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .card {
      background: var(--bg-alt);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-soft);
      padding: 18px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 700;
    }

    .card-subtitle {
      font-size: 0.84rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .card-badge {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: var(--primary);
      font-weight: 600;
    }

    .card-content {
      font-size: 0.9rem;
      color: var(--text-main);
    }

    .card-rows {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .row-label {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .row-value {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .row-value.negativo {
      color: #22c55e;
    }

    .row-value.neutro {
      color: #6b7280;
    }

    .row-value.atencao {
      color: #b91c1c;
    }

    .row-small {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--primary);
      color: #ffffff;
      box-shadow: 0 10px 22px rgba(30, 90, 77, 0.55);
      margin-top: 6px;
      text-decoration: none;
    }

    .btn:hover {
      background: #124538;
    }

    .btn-secondary {
      background: #e5efe9;
      color: #065f46;
      box-shadow: none;
    }

    .btn-secondary:hover {
      background: #d1e7dd;
    }

    .badge-medidas {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .badge-medida {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 10px;
      font-size: 0.78rem;
      background: #f9fafb;
      white-space: nowrap;
    }

    .badge-medida strong {
      font-weight: 600;
      margin-right: 3px;
    }

    .badge-medida .valor {
      font-weight: 600;
    }

    .badge-medida .valor.vazio {
      color: #9ca3af;
      font-weight: 400;
    }

    .peso-card-main {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 10px;
      align-items: center;
    }

    @media (max-width: 780px) {
      .peso-card-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .peso-valor {
      font-size: 2rem;
      font-weight: 800;
    }

    .peso-valor span {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-left: 4px;
    }

    .peso-grafico {
      border-radius: 18px;
      border: 1px dashed #d1d5db;
      padding: 8px 10px;
      font-size: 0.8rem;
      color: var(--text-muted);
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .peso-grafico svg {
      width: 100%;
      height: 70px;
    }

    .peso-rodape {
      display: flex;
      justify-content: space-between;
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .tdee-resumo {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tdee-linha {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
    }

    .tdee-linha strong {
      font-weight: 600;
    }

    .tdee-meta {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .lista-simples {
      font-size: 0.88rem;
      display: flex;
      flex-direction: column;
      gap: 3px;
      margin-top: 4px;
    }

    .lista-simples strong {
      font-weight: 600;
    }

    .lista-simples .vazio {
      color: #9ca3af;
    }

    .treino-resumo {
      font-size: 0.88rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
    }

    .treino-resumo li {
      list-style: none;
    }

    footer {
      padding: 10px 16px 18px;
      text-align: center;
      font-size: 0.78rem;
      color: #9ca3af;
    }

    @media (max-width: 480px) {
      .card {
        padding: 16px 14px 16px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <!-- Logo clicável para voltar ao início do Clube -->
      <a href="clube-area.html" class="logo">
        <div class="logo-badge">P&amp;P</div>
        <div>
          <div class="logo-text-main">Prato &amp; Peso</div>
          <div class="logo-text-sub">Clube Prato &amp; Peso</div>
        </div>
      </a>

      <div class="header-right">
        <a href="clube-perfil.html" class="header-link">Perfil</a>
        <button id="btnLogout" class="header-link header-link-cta">Sair</button>
      </div>
    </div>
  </header>

  <main>
    <div class="main-inner">
      <section class="hero">
        <div>
          <h1>Olá, Rafael</h1>
          <p class="hero-subtitle">
            Aqui você acompanha os principais números do seu dia a dia no Clube.
          </p>
        </div>
      </section>

      <section class="cards-grid">
        <!-- RESUMO DO DIA -->
        <article class="card">
          <header class="card-header">
            <div>
              <h2 class="card-title">Resumo de hoje</h2>
              <p class="card-subtitle">
                Visão rápida do seu dia em calorias.
              </p>
            </div>
            <div class="card-badge">Dia a dia</div>
          </header>

          <div class="card-content">
            <div class="card-rows">
              <div>
                <div class="row-label">Gasto estimado hoje</div>
                <div class="row-value" id="resumo-gasto">-- kcal</div>
              </div>
              <div>
                <div class="row-label">Ingeriu hoje</div>
                <div class="row-value" id="resumo-ingerido">-- kcal</div>
              </div>
              <div>
                <div class="row-label">Saldo do dia</div>
                <div class="row-value neutro" id="resumo-saldo">-- kcal</div>
              </div>
            </div>

            <p class="row-small" id="resumo-dia-legenda">
              Conecte o TDEE e o prato de hoje para ver o saldo diário.
            </p>
          </div>
        </article>

        <!-- PESO & PROGRESSO -->
        <article class="card">
          <header class="card-header">
            <div>
              <h2 class="card-title">Peso &amp; progresso</h2>
              <p class="card-subtitle">
                Seu peso atual e a tendência da meta.
              </p>
            </div>
          </header>

          <div class="card-content">
            <div class="peso-card-main">
              <div>
                <div class="row-label">Peso atual</div>
                <div class="peso-valor" id="peso-atual">
                  --,-- <span>kg</span>
                </div>
                <p class="row-small" id="peso-variacao7-text">
                  Você ainda não registrou seu peso no Clube.
                </p>

                <a href="clube-peso.html" class="btn">Ver e registrar peso</a>
              </div>

              <div class="peso-grafico" id="peso-grafico-mini">
                <span>Últimos 7 registros</span>
              </div>
            </div>
          </div>
        </article>

        <!-- TDEE & META -->
        <article class="card">
          <header class="card-header">
            <div>
              <h2 class="card-title">Meu TDEE &amp; Meta</h2>
              <p class="card-subtitle">
                Resumo do gasto calórico diário e da meta.
              </p>
            </div>
          </header>

          <div class="card-content">
            <div class="tdee-resumo">
              <div class="tdee-linha">
                <span>TDEE atual</span>
                <strong id="tdee-atual">-- kcal/dia</strong>
              </div>
              <div class="tdee-linha">
                <span>Objetivo</span>
                <strong id="tdee-meta">Nenhum cálculo salvo ainda.</strong>
              </div>
              <div class="tdee-linha">
                <span>Consumo total hoje</span>
                <strong id="tdee-consumo-hoje">-- kcal</strong>
              </div>
            </div>

            <p class="tdee-meta" id="tdee-meta-descricao">
              Calcule seu TDEE, defina um déficit ou superávit e acompanhe aqui.
            </p>

            <a href="clube-tdee.html" class="btn btn-secondary">
              Ver detalhes da meta
            </a>
          </div>
        </article>

        <!-- MEDIDAS CORPORAIS -->
        <article class="card">
          <header class="card-header">
            <div>
              <h2 class="card-title">Minhas medidas corporais</h2>
              <p class="card-subtitle">
                Acompanhe as principais medidas do seu corpo.
              </p>
            </div>
          </header>

          <div class="card-content">
            <div class="badge-medidas">
              <div class="badge-medida">
                <strong>Pescoço</strong>
                <span class="valor" id="medida-pescoco">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Ombro</strong>
                <span class="valor" id="medida-ombro">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Peito</strong>
                <span class="valor" id="medida-peito">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Cintura</strong>
                <span class="valor" id="medida-cintura">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Abd. sup.</strong>
                <span class="valor" id="medida-abd-sup">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Abd. inf.</strong>
                <span class="valor" id="medida-abd-inf">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Braço esq.</strong>
                <span class="valor" id="medida-braco-e">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Braço dir.</strong>
                <span class="valor" id="medida-braco-d">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Antebraço esq.</strong>
                <span class="valor" id="medida-antebraco-e">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Antebraço dir.</strong>
                <span class="valor" id="medida-antebraco-d">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Coxa esq.</strong>
                <span class="valor" id="medida-coxa-e">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Coxa dir.</strong>
                <span class="valor" id="medida-coxa-d">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Pant. esq.</strong>
                <span class="valor" id="medida-pant-e">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Pant. dir.</strong>
                <span class="valor" id="medida-pant-d">-- cm</span>
              </div>
              <div class="badge-medida">
                <strong>Quadril</strong>
                <span class="valor" id="medida-quadril">-- cm</span>
              </div>
            </div>

            <p class="row-small" id="medidas-legenda">
              Você ainda não registrou suas medidas corporais.
            </p>

            <a href="clube-medidas.html" class="btn btn-secondary">
              Registrar / atualizar medidas
            </a>
          </div>
        </article>

        <!-- PRATO BRASILEIRO -->
        <article class="card">
          <header class="card-header">
            <div>
              <h2 class="card-title">Montar prato brasileiro</h2>
              <p class="card-subtitle">
                Você ainda não registrou um prato no Clube.
              </p>
            </div>
          </header>

          <div class="card-content">
            <div class="lista-simples">
              <div>
                <strong>Último prato registrado em</strong>
                <span id="prato-data">--/--</span>
              </div>
              <div>
                <strong>Consumo total hoje</strong>
                <span id="prato-calorias">-- kcal</span>
              </div>
            </div>

            <p class="row-small" id="card-prato-subtitle">
              Monte o prato do dia e veja a soma em kcal.
            </p>

            <a href="clube-prato.html" class="btn">
              Montar / atualizar prato de hoje
            </a>
          </div>
        </article>

        <!-- TREINO DE HOJE -->
        <article class="card">
          <header class="card-header">
            <div>
              <h2 class="card-title">Treino de hoje / Academia</h2>
              <p class="card-subtitle">
                Últimos pesos para você lembrar na próxima sessão.
              </p>
            </div>
          </header>

          <div class="card-content">
            <ul class="treino-resumo">
              <li id="treino-ultimo">
                <strong>Último treino:</strong> nenhum treino registrado ainda.
              </li>
              <li id="treino-ex1" style="display:none;"></li>
              <li id="treino-ex2" style="display:none;"></li>
            </ul>

            <a href="clube-treino.html" class="btn btn-secondary">
              Registrar treino de hoje
            </a>
          </div>
        </article>
      </section>
    </div>
  </main>

  <footer>
    © 2025 Prato &amp; Peso – Área do Clube.
  </footer>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyABfAWUAW6a6g93B9QKooTKd5Mj645G3vE",
      authDomain: "prato-e-peso-77b5a.firebaseapp.com",
      projectId: "prato-e-peso-77b5a",
      storageBucket: "prato-e-peso-77b5a.firebasestorage.app",
      messagingSenderId: "432109202072",
      appId: "1:432109202072:web:1c8636db0c161318ddfeed"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUid = null;

    /* ---------- Referências DOM ---------- */
    const btnLogout         = document.getElementById("btnLogout");

    // prato
    const pratoDataSpan     = document.getElementById("prato-data");
    const pratoCaloriasSpan = document.getElementById("prato-calorias");
    const pratoSubtitle     = document.getElementById("card-prato-subtitle");

    // peso
    const pesoAtualSpan     = document.getElementById("peso-atual");
    const pesoVariacao7Text = document.getElementById("peso-variacao7-text");
    let graficoPesoMini = null;

    // TDEE
    const tdeeAtualSpan     = document.getElementById("tdee-atual");
    const tdeeMetaDescricao = document.getElementById("tdee-meta-descricao");
    const tdeeMetaSpan      = document.getElementById("tdee-meta");
    const tdeeConsumoHojeSpan = document.getElementById("tdee-consumo-hoje");

    // resumo do dia
    const resumoGastoSpan   = document.getElementById("resumo-gasto");
    const resumoIngeridoSpan= document.getElementById("resumo-ingerido");
    const resumoSaldoSpan   = document.getElementById("resumo-saldo");
    const resumoDiaLegenda  = document.getElementById("resumo-dia-legenda");

    // medidas
    const medidaPescocoSpan   = document.getElementById("medida-pescoco");
    const medidaOmbroSpan     = document.getElementById("medida-ombro");
    const medidaPeitoSpan     = document.getElementById("medida-peito");
    const medidaCinturaSpan   = document.getElementById("medida-cintura");
    const medidaAbdSupSpan    = document.getElementById("medida-abd-sup");
    const medidaAbdInfSpan    = document.getElementById("medida-abd-inf");
    const medidaBracoESpan    = document.getElementById("medida-braco-e");
    const medidaBracoDSpan    = document.getElementById("medida-braco-d");
    const medidaAntebracoESpan = document.getElementById("medida-antebraco-e");
    const medidaAntebracoDSpan = document.getElementById("medida-antebraco-d");
    const medidaCoxaESpan      = document.getElementById("medida-coxa-e");
    const medidaCoxaDSpan      = document.getElementById("medida-coxa-d");
    const medidaPantESpan      = document.getElementById("medida-pant-e");
    const medidaPantDSpan      = document.getElementById("medida-pant-d");
    const medidaQuadrilSpan    = document.getElementById("medida-quadril");
    const medidasLegenda       = document.getElementById("medidas-legenda");

    // treino
    const treinoUltimoLi = document.getElementById("treino-ultimo");
    const treinoEx1Li    = document.getElementById("treino-ex1");
    const treinoEx2Li    = document.getElementById("treino-ex2");

    /* ---------- Funções auxiliares ---------- */
    function formatarDataBR(dataISO) {
      if (!dataISO) return "--/--";
      const [ano, mes, dia] = dataISO.split("-");
      if (!ano || !mes || !dia) return dataISO;
      return `${dia}/${mes}`;
    }

    function formatarNumero(num, casas = 1) {
      if (num === null || num === undefined || isNaN(num)) return "--";
      return num.toFixed(casas).replace(".", ",");
    }

    /* ---------- Resumo prato ---------- */
    async function carregarResumoPrato(uid) {
      try {
        const hoje = new Date();
        const yyyy = hoje.getFullYear();
        const mm = String(hoje.getMonth() + 1).padStart(2, "0");
        const dd = String(hoje.getDate()).padStart(2, "0");
        const hojeStr = `${yyyy}-${mm}-${dd}`;

        const ref = await db
          .collection("pratos")
          .where("uid", "==", uid)
          .where("data", "==", hojeStr)
          .limit(1)
          .get();

        if (ref.empty) {
          pratoDataSpan.textContent = "--/--";
          pratoCaloriasSpan.textContent = "-- kcal";
          pratoSubtitle.textContent = "Monte o prato do dia e veja a soma em kcal.";
          return;
        }

        const doc = ref.docs[0].data();
        pratoDataSpan.textContent = formatarDataBR(doc.data);
        const kcal = doc.totalKcal || 0;
        pratoCaloriasSpan.textContent = `${kcal} kcal`;
        pratoSubtitle.textContent = "Último prato registrado no dia de hoje.";
      } catch (err) {
        console.error("Erro ao carregar resumo de prato:", err);
        pratoSubtitle.textContent = "Erro ao carregar os dados do prato.";
      }
    }

    /* ---------- Peso & gráfico mini ---------- */
    async function carregarPesoEProgresso(uid) {
      try {
        const snapshot = await db
          .collection("pesos")
          .where("uid", "==", uid)
          .orderBy("data", "desc")
          .limit(7)
          .get();

        if (snapshot.empty) {
          pesoAtualSpan.innerHTML = "--,-- <span>kg</span>";
          pesoVariacao7Text.textContent = "Você ainda não registrou seu peso no Clube.";
          return;
        }

        const docs = snapshot.docs.slice().reverse();
        const pesos = docs.map(d => ({
          data: d.data().data,
          peso: d.data().peso
        }));

        const ultimo = pesos[pesos.length - 1];
        pesoAtualSpan.innerHTML = `${formatarNumero(ultimo.peso, 1)} <span>kg</span>`;

        if (pesos.length >= 2) {
          const primeiro = pesos[0];
          const variacao = ultimo.peso - primeiro.peso;
          const textoVar =
            variacao > 0
              ? `Subiu ${formatarNumero(variacao, 1)} kg nos últimos ${pesos.length} registros.`
              : variacao < 0
              ? `Desceu ${formatarNumero(Math.abs(variacao), 1)} kg nos últimos ${pesos.length} registros.`
              : `Manteve o peso nos últimos ${pesos.length} registros.`;
          pesoVariacao7Text.textContent = textoVar;
        } else {
          pesoVariacao7Text.textContent =
            "Aguarde mais registros para ver a tendência do peso.";
        }

        const container = document.getElementById("peso-grafico-mini");
        container.innerHTML = "";

        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("viewBox", "0 0 100 40");

        const valores = pesos.map(p => p.peso);
        const min = Math.min(...valores);
        const max = Math.max(...valores);
        const range = max - min || 1;

        let pathD = "";
        pesos.forEach((p, idx) => {
          const x = (idx / (pesos.length - 1 || 1)) * 100;
          const y = 35 - ((p.peso - min) / range) * 30;
          pathD += idx === 0 ? `M ${x},${y}` : ` L ${x},${y}`;
        });

        const path = document.createElementNS(svgNS, "path");
        path.setAttribute("d", pathD);
        path.setAttribute("fill", "none");
        path.setAttribute("stroke", "#16a34a");
        path.setAttribute("stroke-width", "1.6");

        const area = document.createElementNS(svgNS, "path");
        if (pesos.length > 1) {
          let areaD = pathD;
          const lastX =
            ( (pesos.length - 1) / (pesos.length - 1 || 1) ) * 100;
          areaD += ` L ${lastX},38 L 0,38 Z`;
          area.setAttribute("d", areaD);
          area.setAttribute("fill", "rgba(34, 197, 94, 0.15)");
        }

        svg.appendChild(area);
        svg.appendChild(path);
        container.appendChild(svg);
      } catch (err) {
        console.error("Erro ao carregar peso/progresso:", err);
        pesoVariacao7Text.textContent = "Erro ao carregar dados de peso.";
      }
    }

    /* ---------- TDEE & meta ---------- */
    async function carregarResumoTdee(uid) {
      try {
        const ref = await db
          .collection("tdee")
          .where("uid", "==", uid)
          .orderBy("atualizadoEm", "desc")
          .limit(1)
          .get();

        if (ref.empty) {
          tdeeAtualSpan.textContent = "-- kcal/dia";
          tdeeMetaSpan.textContent = "Nenhum cálculo salvo ainda.";
          tdeeMetaDescricao.textContent =
            "Calcule seu TDEE, defina um déficit ou superávit e acompanhe aqui.";
          return;
        }

        const doc = ref.docs[0].data();
        const tdee = doc.tdeeAtual || 0;
        const metaDescricao = doc.metaDescricao || "";
        const consumoHoje = doc.consumoHoje || 0;

        tdeeAtualSpan.textContent = `${tdee} kcal/dia`;
        tdeeMetaSpan.textContent = metaDescricao || "Nenhum objetivo registrado.";
        tdeeMetaDescricao.textContent =
          doc.legenda || "Resumo do seu TDEE com a meta aplicada.";
        tdeeConsumoHojeSpan.textContent = `${consumoHoje} kcal`;
      } catch (err) {
        console.error("Erro ao carregar resumo TDEE:", err);
        tdeeMetaDescricao.textContent = "Erro ao carregar dados de TDEE.";
      }
    }

    /* ---------- Medidas corporais ---------- */
    async function carregarResumoMedidas(uid) {
      try {
        const ref = await db
          .collection("medidas")
          .where("uid", "==", uid)
          .orderBy("data", "desc")
          .limit(1)
          .get();

        if (ref.empty) {
          [
            medidaPescocoSpan,
            medidaOmbroSpan,
            medidaPeitoSpan,
            medidaCinturaSpan,
            medidaAbdSupSpan,
            medidaAbdInfSpan,
            medidaBracoESpan,
            medidaBracoDSpan,
            medidaAntebracoESpan,
            medidaAntebracoDSpan,
            medidaCoxaESpan,
            medidaCoxaDSpan,
            medidaPantESpan,
            medidaPantDSpan,
            medidaQuadrilSpan
          ].forEach((el) => {
            el.textContent = "-- cm";
            el.classList.add("valor", "vazio");
          });

          medidasLegenda.textContent =
            "Você ainda não registrou suas medidas corporais.";
          return;
        }

        const m = ref.docs[0].data();
        const mapa = {
          medidaPescocoSpan: m.pescoco,
          medidaOmbroSpan: m.ombro,
          medidaPeitoSpan: m.peito,
          medidaCinturaSpan: m.cintura,
          medidaAbdSupSpan: m.abdSup,
          medidaAbdInfSpan: m.abdInf,
          medidaBracoESpan: m.bracoE,
          medidaBracoDSpan: m.bracoD,
          medidaAntebracoESpan: m.antebracoE,
          medidaAntebracoDSpan: m.antebracoD,
          medidaCoxaESpan: m.coxaE,
          medidaCoxaDSpan: m.coxaD,
          medidaPantESpan: m.pantE,
          medidaPantDSpan: m.pantD,
          medidaQuadrilSpan: m.quadril
        };

        Object.entries(mapa).forEach(([id, valor]) => {
          const el = eval(id); // usar as const já criadas
          if (valor) {
            el.textContent = `${valor} cm`;
            el.classList.remove("vazio");
            el.classList.add("valor");
          } else {
            el.textContent = "-- cm";
            el.classList.add("valor", "vazio");
          }
        });

        medidasLegenda.textContent =
          `Última atualização em ${formatarDataBR(m.data || "")}.`;
      } catch (err) {
        console.error("Erro ao carregar medidas:", err);
        medidasLegenda.textContent = "Erro ao carregar medidas.";
      }
    }

    /* ---------- Resumo treino ---------- */
    async function carregarResumoTreino(uid) {
      try {
        const snapshot = await db
          .collection("treinos")
          .where("uid", "==", uid)
          .get();

        if (snapshot.empty) {
          treinoUltimoLi.innerHTML =
            "<strong>Último treino:</strong> nenhum treino registrado ainda.";
          treinoEx1Li.style.display = "none";
          treinoEx2Li.style.display = "none";
          return;
        }

        const docs = snapshot.docs.slice();
        docs.sort((a, b) => {
          const da = a.data().data || "";
          const dbb = b.data().data || "";
          if (da < dbb) return 1;
          if (da > dbb) return -1;
          return 0;
        });

        const ultimo = docs[0].data();
        const dataBR = ultimo.data ? formatarDataBR(ultimo.data) : "";
        const nomeTreino = ultimo.nomeTreino ||
          (ultimo.tipoTreino ? `Treino ${ultimo.tipoTreino}` : "Treino");

        treinoUltimoLi.innerHTML =
          `<strong>Último treino:</strong> ${dataBR} – ${nomeTreino}`;

        const exs = Array.isArray(ultimo.exercicios) ? ultimo.exercicios : [];
        if (exs.length > 0) {
          treinoEx1Li.style.display = "list-item";
          treinoEx1Li.textContent = `${exs[0].nome} – ${exs[0].pesoKg} kg`;
        } else {
          treinoEx1Li.style.display = "none";
        }

        if (exs.length > 1) {
          treinoEx2Li.style.display = "list-item";
          treinoEx2Li.textContent = `${exs[1].nome} – ${exs[1].pesoKg} kg`;
        } else {
          treinoEx2Li.style.display = "none";
        }
      } catch (err) {
        console.error("Erro ao carregar resumo de treino:", err);
        treinoUltimoLi.innerHTML =
          "<strong>Último treino:</strong> não foi possível carregar os dados.";
        treinoEx1Li.style.display = "none";
        treinoEx2Li.style.display = "none";
      }
    }

    /* ---------- Logout & limpeza de cache ---------- */
    function limparLocalStorageClube() {
      try {
        localStorage.removeItem("pp_user_uid");
        localStorage.removeItem("pp_user_email");
        localStorage.removeItem("pp_user_nome");
        localStorage.removeItem("pp_plano_codigo");
        localStorage.removeItem("pp_plano_nome");
      } catch (e) {
        console.warn("Não foi possível limpar localStorage do Clube:", e);
      }
    }

    function fazerLogout() {
      auth.signOut().finally(() => {
        limparLocalStorageClube();
        window.location.href = "clube-login.html";
      });
    }

    if (btnLogout) {
      btnLogout.addEventListener("click", fazerLogout);
    }

    /* ---------- Login / inicialização ---------- */
    auth.onAuthStateChanged((user) => {
      if (!user) {
        window.location.href = "clube-login.html";
        return;
      }

      currentUid = user.uid;

      carregarResumoPrato(currentUid);
      carregarPesoEProgresso(currentUid);
      carregarResumoTdee(currentUid);
      carregarResumoMedidas(currentUid);
      carregarResumoTreino(currentUid);
    });
  </script>
</body>
</html>
